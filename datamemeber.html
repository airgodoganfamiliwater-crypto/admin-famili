<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#14b8a6">
<link rel="icon" href="ikon-512.png">
<title>Admin Panel ‚Äì Members & Agens</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Nunito', sans-serif;
  background:
    radial-gradient(circle at top left, rgba(20,184,166,.15), transparent 50%),
    radial-gradient(circle at bottom right, rgba(251,146,60,.1), transparent 50%),
    linear-gradient(135deg, #f3f4f6, #e0f2fe);
    min-height:100vh;
    padding-bottom: 50px;
}
  /* ================= GENERAL ================= */
  * {
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    outline: none;
  }
  
  /* ================= THEME ================= */
  :root{
    --primary:#14b8a6;      /* Biru kehijauan futuristik */
    --accent:#fb923c;       /* Oranye aksen */
    --bg:#f3f4f6;           /* Latar belakang cerah */
    --card:#ffffff;         /* Card putih bersih */
    --border:#d1d5db;       /* Border abu lembut */
    --text:#1f2937;         /* Teks utama gelap lembut */
    --muted:#f3f3f3;        /* Teks sekunder */
    --glow:0 0 20px rgba(20,184,166,.2);
  }
  /* Header */
  .header {
    background: var(--primary);
    height: 120px;
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
    position: relative;
  }
  /* Fade-in container */
  .container {
    opacity: 0;
    transform: translateY(20px); /* sedikit turun untuk efek */
    transition: opacity 0.5s ease, transform 0.5s ease;
  }
  
  .container.show {
    opacity: 1;
    transform: translateY(0);
  }  
  /* Container */
  .container {
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 20px;
    position: relative;
    z-index: 1;
  }
  
  /* Card */
  .card {
    background: var(--card);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    position: relative;
    top: -40px; /* Card menimpa header sedikit */
  }
   .card h1 {
    margin-top: 0;
    color: var(--primary);
    font-size: 30px;
    text-align: center;
  }
   .card h2 {
    margin-top: 0;
    color: var(--primary);
    font-size: 20px;
  }
/* SEARCH */
}
.search-box input{
  border:none;
  outline:none;
  flex:1;
  font-size:14px;
  background: var(--muted);
  border-radius:16px;
  padding:12px 14px;
  margin-bottom:18px;
  display:flex;
  align-items:center;
  gap:10px;
}

/* LIST */
.box{
  background:#fff;
  border-radius:16px;
  padding:8px;
  box-shadow:0 8px 20px rgba(0,0,0,.06);
}
.item{
  background:#f9fafb;
  padding:12px;
  border-radius:12px;
  margin-bottom:8px;
}
.big{
  font-weight:600;
  color:var(--accent);
  cursor:pointer
}
.small{
  font-size:12px;
  color:#6b7280
}

/* POPUP */
.popup {
  display: none;
  position: absolute; /* agar bisa digeser ke atas */
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,.4);
  backdrop-filter: blur(6px);
  z-index: 999;
  overflow: auto; /* supaya scroll muncul kalau popup terlalu panjang */
}
.popup-content{
  background:#fff;
  width:92%;
  max-width:360px;
  margin:200px auto;
  padding:16px;
  border-radius:18px;
}

/* POPUP HEADER */
.popup-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.popup-header h3{
  margin:0;
  font-size:20px;
  color:var(--primary);
}
.btn-delete{
  background:#fee2e2;
  color:#b91c1c;
  border:none;
  border-radius:10px;
  padding:6px 10px;
  font-size:12px;
  cursor:pointer;
}

/* FORM */
label{font-size:12px;color:#374151}
input{
  width:100%;
  padding:10px;
  margin:6px 0 12px;
  border-radius:10px;
  border:1px solid #d1d5db;
}

/* ACTIONS */
.actions{
  display:flex;
  gap:10px;
}
.btn{
  flex:1;
  padding:10px;
  border:none;
  border-radius:12px;
  font-size:14px;
  cursor:pointer;
}
.btn-primary{
  background:var(--primary);
  color:#fff;
}
.btn-secondary{
  background:var(--accent);
}
  /* NAVIGASI BAWAH */
  .bottomNav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #fff;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
  }
  
  .navItem {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--primary);
    text-decoration: none;
    font-size: 12px;
  }
  
  .navIcon {
    background: var(--muted);
    border-radius: 50%;
    padding: 8px;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    transition: all 0.2s ease;
  }
  
  .navIcon svg {
    width: 20px;
    height: 20px;
    stroke: var(--primary);
  }
  
  /* NAVIGASI BAWAH AKTIF */
  .navItem.active .navIcon {
    background: var(--accent);
  }
  
  .navItem.active span {
    color: var(--accent);
  }
  
  /* Hover tetap */
  .navItem:hover .navIcon {
    background: var(--accent);
  }
  
  .navItem:hover span {
    color: var(--accent);
  }
</style>
</head>

<body>
<div class="header"></div>
<div class="container">
  <div class="card">
    <h1>Data Member</h1>
    <!-- BUTTON KIRIM NOTIF -->
    <div style="margin: 10px 0; display:flex; justify-content:flex-end;">
      <button class="btn btn-primary" onclick="openNotifPopup()">Kirim Notifikasi</button>
    </div>
     <!-- üîç SEARCH -->
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Cari nama ID atau nama lengkap..." oninput="applySearch()">
    </div>
  </div>
  <div class="card">
    <h2>Agens Approved</h2>
    <div class="box" id="agensBox">Loading...</div>
  </div>
  <div class="card">
    <h2>Members Approved</h2>
    <div class="box" id="membersBox">Loading...</div>
  </div>
</div>
<!-- POPUP NOTIF -->
<div id="notifPopup" class="popup">
  <div class="popup-content">
    <div class="popup-header">
      <h3>Kirim Notifikasi</h3>
      <button class="btn-delete" onclick="closeNotifPopup()">‚úñ</button>
    </div>

    <label>Judul</label>
    <input id="notifTitle" placeholder="Masukkan judul">

    <label>Pesan</label>
    <input id="notifBody" placeholder="Masukkan pesan">

    <label>Link Gambar (optional)</label>
    <input id="notifImage" placeholder="https://...">

    <div class="actions">
      <button class="btn btn-secondary" onclick="closeNotifPopup()">Batal</button>
      <button id="btnSendNotif" class="btn btn-primary" onclick="sendNotif()">Kirim</button>
    </div>
  </div>
</div>

<!-- POPUP -->
<div id="popup" class="popup">
  <div class="popup-content">
    <div class="popup-header">
      <h3 id="popupTitle"></h3>
      <button id="deleteBtn" class="btn-delete" onclick="deleteDoc()">üóë Hapus</button>
    </div>
    <div id="popupBody"></div>
    <div class="actions">
      <button class="btn btn-secondary" onclick="closePopup()">Batal</button>
      <button class="btn btn-primary" onclick="saveData()">Simpan</button>
    </div>
  </div>
</div>
<!-- POPUP KONFIRMASI SIMPAN -->
<div id="popupConfirmSave" class="popup">
  <div class="popup-content">
    <h3>Konfirmasi Simpan</h3>
    <p>Apakah Anda yakin ingin menyimpan perubahan ini?</p>
    <div class="actions">
      <button class="btn btn-secondary" onclick="closeConfirmSave()">Batal</button>
      <button class="btn btn-primary" id="btnConfirmSaveOk">Oke</button>
    </div>
  </div>
</div>
<!-- NAVIGASI BAWAH -->
<div class="bottomNav">
  <a href="index.html" class="navItem">
    <div class="navIcon">
      <!-- Home SVG -->
      <svg width="36" viewBox="0 0 1664 1312" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M1408 768v480q0 26-19 45t-45 19H960V928H704v384H320q-26 0-45-19t-19-45V768q0-1 .5-3t.5-3l575-474l575 474q1 2 1 6zm223-69l-62 74q-8 9-21 11h-3q-13 0-21-7L832 200L140 777q-12 8-24 7q-13-2-21-11l-62-74q-8-10-7-23.5T37 654L756 55q32-26 76-26t76 26l244 204V64q0-14 9-23t23-9h192q14 0 23 9t9 23v408l219 182q10 8 11 21.5t-7 23.5z" fill="currentColor"/></svg>
    </div>
    <span>Home</span>
  </a>
  <a href="helper.html" class="navItem">
    <div class="navIcon">
      <!-- Edit SVG -->
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z" />
        <path fill-rule="evenodd" d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z" clip-rule="evenodd" />
      </svg>


    </div>
    <span>Helper</span>
  </a>
  <a href="datamemeber.html" class="navItem">
    <div class="navIcon">
      <!-- Member / User SVG -->
       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
        <path fill-rule="evenodd" d="M8.25 6.75a3.75 3.75 0 1 1 7.5 0 3.75 3.75 0 0 1-7.5 0ZM15.75 9.75a3 3 0 1 1 6 0 3 3 0 0 1-6 0ZM2.25 9.75a3 3 0 1 1 6 0 3 3 0 0 1-6 0ZM6.31 15.117A6.745 6.745 0 0 1 12 12a6.745 6.745 0 0 1 6.709 7.498.75.75 0 0 1-.372.568A12.696 12.696 0 0 1 12 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 0 1-.372-.568 6.787 6.787 0 0 1 1.019-4.38Z" clip-rule="evenodd" />
        <path d="M5.082 14.254a8.287 8.287 0 0 0-1.308 5.135 9.687 9.687 0 0 1-1.764-.44l-.115-.04a.563.563 0 0 1-.373-.487l-.01-.121a3.75 3.75 0 0 1 3.57-4.047ZM20.226 19.389a8.287 8.287 0 0 0-1.308-5.135 3.75 3.75 0 0 1 3.57 4.047l-.01.121a.563.563 0 0 1-.373.486l-.115.04c-.567.2-1.156.349-1.764.441Z" />
      </svg>

    </div>
    <span>Member</span>
  </a>
</div>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyCl13_a4x-BQnWNUjf9JOQX1DKc-HxLBys",
  authDomain: "klien-39696.firebaseapp.com",
  projectId: "klien-39696"
});

const auth=firebase.auth();
const db=firebase.firestore();

let currentType="",currentId="";
let membersData=[], agensData=[];

/* AUTH */
auth.onAuthStateChanged(async user=>{
  if(!user) return alert("Belum login");
  const a=await db.collection("admins").doc(user.uid).get();
  if(!a.exists) return alert("Bukan admin");
  loadMembers(); loadAgens();
});

/* LOAD MEMBERS */
async function loadMembers(){
  const snap=await db.collection("members").where("status","==","approved").get();
  membersData=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderMembers(membersData);
}
function renderMembers(data){
  membersBox.innerHTML=data.length?data.map(x=>`
    <div class="item">
      <div class="big" onclick="openDetail('members','${x.id}')">${x.namaID}</div>
      <div class="small">${x.namaLengkap||""}</div>
    </div>`).join(""):"Tidak ada member";
}

/* LOAD AGENS */
async function loadAgens(){
  const snap=await db.collection("agens").where("status","==","approved").get();
  agensData=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderAgens(agensData);
}
function renderAgens(data){
  agensBox.innerHTML=data.length?data.map(x=>`
    <div class="item">
      <div class="big" onclick="openDetail('agens','${x.id}')">${x.namaID}</div>
      <div class="small">${x.namaLengkap||""}</div>
    </div>`).join(""):"Tidak ada agen";
}

/* SEARCH */
function applySearch(){
  const q=searchInput.value.toLowerCase();
  renderMembers(membersData.filter(d=>
    (d.namaID||"").toLowerCase().includes(q) ||
    (d.namaLengkap||"").toLowerCase().includes(q)
  ));
  renderAgens(agensData.filter(d=>
    (d.namaID||"").toLowerCase().includes(q) ||
    (d.namaLengkap||"").toLowerCase().includes(q)
  ));
}

/* Popup kirim notif*/
function openNotifPopup(){
  notifPopup.style.display = "block";
}

function closeNotifPopup(){
  notifPopup.style.display = "none";
}

/* PANNGIL GAS */
async function sendNotif(){
  const title = notifTitle.value.trim();
  const body  = notifBody.value.trim();
  const img   = notifImage.value.trim();

  const btn = document.getElementById("btnSendNotif");
  btn.disabled = true;
  btn.innerText = "Mengirim...";

  if(!title || !body){
    alert("Judul dan pesan wajib diisi");
    btn.disabled = false;
    btn.innerText = "Kirim";
    return;
  }

  const url = "https://script.google.com/macros/s/AKfycbzutySK5xbgPzcxvYCmDHF7ZgOs_xkS_HaAUArIJG8cjYfbKTqrijw_594hfWtb-9bZ/exec";

  try {
    await fetch(url, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title, body, image: img })
    });

    alert("‚úÖ Notifikasi berhasil dikirim");
    closeNotifPopup();

    notifTitle.value = "";
    notifBody.value  = "";
    notifImage.value = "";

  } catch(err){
    console.error(err);
    alert("‚ùå Gagal mengirim notifikasi");
  } finally {
    btn.disabled = false;
    btn.innerText = "Kirim";
  }
}

/* OPEN popup edit*/
async function openDetail(type,id){
  currentType = type;
  currentId = id;
  const d = (await db.collection(type).doc(id).get()).data();

  popupTitle.innerText = type === "members" ? "Edit Member" : "Edit Agen";
  deleteBtn.style.display = type === "members" ? "block" : "none";

  popupBody.innerHTML = `
    <label>Nama ID</label>
    <input id="f_namaID" value="${d.namaID||''}">
    
    <label>Nama Lengkap</label>
    <input id="f_namaLengkap" value="${d.namaLengkap||''}">

    <label>Order Gift</label>
    <input id="f_orderGift" value="${d.orderGift||''}">

    <label>Point</label>
    <input id="f_point" value="${d.point||0}">

    <label>Wilayah</label>
    <input id="f_wilayah" value="${d.wilayah||''}">
  `;
  popup.style.display = "block";
}

/* SAVE */
function saveData() {
  // tampilkan popup konfirmasi
  document.getElementById('popupConfirmSave').style.display = 'flex';
}

// tombol Oke di popup konfirmasi
document.getElementById('btnConfirmSaveOk').onclick = async () => {
  try {
    await db.collection(currentType).doc(currentId).update({
      namaID: f_namaID.value,
      namaLengkap: f_namaLengkap.value,
      orderGift: f_orderGift.value,
      point: parseInt(f_point.value) || 0,
      wilayah: f_wilayah.value
    });

    alert("‚úÖ Data berhasil disimpan!");
    closeConfirmSave();
    closePopup();
    loadMembers();
    loadAgens();
  } catch (err) {
    console.error(err);
    alert("‚ùå Gagal menyimpan data!");
  }
};

// tutup popup konfirmasi
function closeConfirmSave() {
  document.getElementById('popupConfirmSave').style.display = 'none';
}

/* DELETE */
async function deleteDoc(){
  if(!confirm("‚ö†Ô∏è Yakin ingin menghapus data ini?")) return;
  await db.collection(currentType).doc(currentId).delete();
  closePopup(); loadMembers(); loadAgens();
}

function closePopup(){ popup.style.display="none"; }
  // ==========================
  // SET HALAMAN AKTIF NAVIGASI
  // ==========================
  const navLinks = document.querySelectorAll('.navItem');
  const currentPage = window.location.pathname.split("/").pop(); // ambil nama file saat ini
  
  navLinks.forEach(link => {
    const href = link.getAttribute('href');
    if(href === currentPage){
      link.classList.add('active'); // tandai halaman aktif
    }
  
    // Optional: smooth hover klik (langsung ke halaman)
    link.addEventListener('click', () => {
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');
    });
  });
  
  //transisi
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('.container');
    setTimeout(() => {
      container.classList.add('show');
    }, 50); // delay kecil supaya transisi terlihat
  });
</script>

</body>
</html>